"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6803],{6803:(S,E,o)=>{o.r(E),o.d(E,{ListPage:()=>l});var u=o(5861),g=o(6814),c=o(95),s=o(3703),d=o(209),e=o(6689),D=o(5349),a=o(6132),_=o(2555);function t(n,A){if(1&n){const L=e.EpF();e.TgZ(0,"ion-item")(1,"ion-label")(2,"h1",7),e.NdJ("click",function(){const v=e.CHM(L).$implicit,h=e.oxw();return e.KtG(h.selectDevice(v))}),e._uU(3),e.qZA(),e.TgZ(4,"h2",8),e.NdJ("click",function(){const v=e.CHM(L).$implicit,h=e.oxw();return e.KtG(h.selectDevice(v))}),e._uU(5),e.qZA(),e.TgZ(6,"h3",9)(7,"ion-badge",10),e._uU(8),e.qZA()()(),e.TgZ(9,"ion-button",11),e.NdJ("click",function(){const v=e.CHM(L).$implicit,h=e.oxw();return e.KtG(h.editDevice(v))}),e._uU(10,"Edit"),e.qZA()()}if(2&n){const L=A.$implicit,r=e.oxw();e.xp6(3),e.Oqu(L.deviceTitle),e.xp6(2),e.Oqu(L.deviceURL),e.xp6(2),e.s9C("color",r.deviceStatusColor[L.deviceID]),e.xp6(1),e.Oqu(r.deviceStatus[L.deviceID])}}const i=function(){return["/"]};let l=(()=>{var n;class A{constructor(r,p,v,h){this.router=r,this.localAppDataService=p,this.backendDataService=v,this.platform=h,this.deviceStatus=Array(),this.deviceStatusColor=Array(),this.deviceInfoDebug=" "}ngOnInit(){}ionViewWillEnter(){this.localAppDataService.getDeviceList().then(this.findDeviceOnThisHost.bind(this)),this.refreshIntervalID=setInterval(this.deviceStatusRefresh.bind(this),3e3)}ionViewDidLeave(){this.refreshIntervalID&&clearInterval(this.refreshIntervalID)}newDevice(){this.localAppDataService.selectedItemforEdit={deviceID:0,deviceTitle:"new-device",deviceURL:"http://",deviceKEY:"new-key"},this.localAppDataService.selectedItemIndex=null,this.router.navigate(["/device-data"])}editDevice(r){this.localAppDataService.selectedItemforEdit=r,this.localAppDataService.selectedItemIndex=this.localAppDataService.deviceList.indexOf(r),this.router.navigate(["/device-data"])}selectDevice(r){this.localAppDataService.saveLocalAppconfig(r),this.router.navigate(["/"])}deviceStatusRefresh(){var r=this;return(0,u.Z)(function*(){r.localAppDataService.deviceList&&r.localAppDataService.deviceList.forEach(function(p){this.ping_device(p.deviceID,p.deviceURL,p.deviceKEY)}.bind(r))})()}ping_device(r,p,v){var h=this;return(0,u.Z)(function*(){h.backendDataService.ServerKEY=v,h.backendDataService.ServerURL=p,yield h.backendDataService.checkDeviceVersion().subscribe(P=>{h.deviceStatus[r]="Connection OK",h.deviceStatusColor[r]="success"},P=>{h.deviceStatus[r]="Connection error",h.deviceStatusColor[r]="warning"})})()}findDeviceOnThisHost(){if(console.log("Trying to find a device on this host/port"),0==this.platform.is("cordova")&&(this.platform.is("mobileweb")||this.platform.is("desktop"))){let r=window.location.origin;this.localAppDataService.deviceList.find(v=>v.deviceURL===r)||(this.localAppDataService.deviceList.push({deviceID:999,deviceTitle:r,deviceURL:r,deviceKEY:"new-key"}),this.localAppDataService.saveDeviceList(this.localAppDataService.deviceList))}}}return(n=A).\u0275fac=function(r){return new(r||n)(e.Y36(d.F0),e.Y36(D.M),e.Y36(a.W),e.Y36(_.t4))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-list"]],standalone:!0,features:[e.jDz],decls:13,vars:5,consts:[[3,"translucent"],["slot","start"],["fill","solid",3,"routerLink"],["slot","end"],["fill","solid",3,"click"],[3,"fullscreen"],[4,"ngFor","ngForOf"],[3,"click"],[1,"item-note",3,"click"],[1,"item-note"],[3,"color"],["large","","clear","","slot","end",3,"click"]],template:function(r,p){1&r&&(e.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),e._uU(3,"Device List"),e.qZA(),e.TgZ(4,"ion-buttons",1)(5,"ion-button",2),e._uU(6," < Back"),e.qZA()(),e.TgZ(7,"ion-buttons",3)(8,"ion-button",4),e.NdJ("click",function(){return p.newDevice()}),e._uU(9,"Add new device"),e.qZA()()()(),e.TgZ(10,"ion-content",5)(11,"ion-list"),e.YNc(12,t,11,4,"ion-item",6),e.qZA()()),2&r&&(e.Q6J("translucent",!0),e.xp6(5),e.Q6J("routerLink",e.DdM(4,i)),e.xp6(5),e.Q6J("fullscreen",!0),e.xp6(2),e.Q6J("ngForOf",p.localAppDataService.deviceList))},dependencies:[g.ez,g.sg,c.u5,d.Bz,d.rH,s.Q$,s.Ie,s.q_,s.W2,s.wd,s.sr,s.Sm,s.Gu,s.yp,s.YG]}),A})()},6132:(S,E,o)=>{o.d(E,{W:()=>e});var u=o(9862),g=o(8504),c=o(7398),s=o(6306),d=o(6689);let e=(()=>{var D;class a{constructor(t){this.http=t,this.ServerURL="http://localhost",this.ServerKEY=" ",this.ServerURLDefault="http://localhost",this.ServerPath="/json_API_v2.php",this.httpOptions={headers:new u.WM({Accept:"application/json","Content-Type":"application/x-www-form-urlencoded"})}}handleError(t){return t.error instanceof ErrorEvent?console.error("An error occurred:",t.error.message):console.error(`Backend returned code ${t.status}, body was: ${t.error}`),(0,g._)("Something bad happened; please try again later.")}extractData(t){return t||{}}checkDeviceVersion(){return this.http.post(this.ServerURL+this.ServerPath,{API_key:this.ServerKEY,request_action:"version_check",request_data:""},this.httpOptions).pipe((0,c.U)(this.extractData),(0,s.K)(this.handleError))}getSensorData(){return this.http.post(this.ServerURL+this.ServerPath,{API_key:this.ServerKEY,request_action:"get_sensor_data",request_data:""},this.httpOptions).pipe((0,c.U)(this.extractData),(0,s.K)(this.handleError))}getSensorDataAndSparkline(){return this.http.post(this.ServerURL+this.ServerPath,{API_key:this.ServerKEY,request_action:"get_sensor_data_sparkline",request_data:""},this.httpOptions).pipe((0,c.U)(this.extractData),(0,s.K)(this.handleError))}getRelayData(){return this.http.post(this.ServerURL+this.ServerPath,{API_key:this.ServerKEY,request_action:"get_GPIO_list",request_data:""},this.httpOptions).pipe((0,c.U)(this.extractData),(0,s.K)(this.handleError))}setRelayState(t,i){return this.http.post(this.ServerURL+this.ServerPath,{API_key:this.ServerKEY,request_action:"set_GPIO_pin",request_data:{pin_id:t,command:i}},this.httpOptions).pipe((0,c.U)(this.extractData),(0,s.K)(this.handleError))}getTriggerData(){return this.http.post(this.ServerURL+this.ServerPath,{API_key:this.ServerKEY,request_action:"get_Trigger_list",request_data:""},this.httpOptions).pipe((0,c.U)(this.extractData),(0,s.K)(this.handleError))}toggleTriggerState(t,i){return this.http.post(this.ServerURL+this.ServerPath,{API_key:this.ServerKEY,request_action:"set_trigger_state",request_data:{triggerID:t,command:i}},this.httpOptions).pipe((0,c.U)(this.extractData),(0,s.K)(this.handleError))}setParameterValue(t,i){return this.http.post(this.ServerURL+this.ServerPath,{API_key:this.ServerKEY,request_action:"setParameterValue",request_data:{parameterID:t,newValue:i}},this.httpOptions).pipe((0,c.U)(this.extractData),(0,s.K)(this.handleError))}setSensorName(t,i){return this.http.post(this.ServerURL+this.ServerPath,{API_key:this.ServerKEY,request_action:"setSensorName",request_data:{sensorID:t,sensorName:i}},this.httpOptions).pipe((0,c.U)(this.extractData),(0,s.K)(this.handleError))}setPinConfig(t,i,l){return this.http.post(this.ServerURL+this.ServerPath,{API_key:this.ServerKEY,request_action:"setPinConfig",request_data:{pinID:t,newPinId:i,pinDescription:l}},this.httpOptions).pipe((0,c.U)(this.extractData),(0,s.K)(this.handleError))}gedDeviceConfig(){let t={API_key:this.ServerKEY,request_action:"getDeviceConfig",request_data:""},i=this.ServerURL+this.ServerPath;return console.log("URL:",i),this.http.post(i,t,this.httpOptions).pipe((0,c.U)(this.extractData),(0,s.K)(this.handleError))}getChartData(t,i){return this.http.post(this.ServerURL+this.ServerPath,{API_key:this.ServerKEY,request_action:"get_historic_data",request_data:{period:t,selected_sensors:i}},this.httpOptions).pipe((0,c.U)(this.extractData),(0,s.K)(this.handleError))}getSensorList(t){return this.http.post(this.ServerURL+this.ServerPath,{API_key:this.ServerKEY,request_action:"get_sensor_list",request_data:{period:t}},this.httpOptions).pipe((0,c.U)(this.extractData),(0,s.K)(this.handleError))}restartDevice(){return this.http.post(this.ServerURL+this.ServerPath,{API_key:this.ServerKEY,request_action:"restart_device"},this.httpOptions).pipe((0,c.U)(this.extractData),(0,s.K)(this.handleError))}shutdownDevice(){return this.http.post(this.ServerURL+this.ServerPath,{API_key:this.ServerKEY,request_action:"shutdown_device"},this.httpOptions).pipe((0,c.U)(this.extractData),(0,s.K)(this.handleError))}}return(D=a).\u0275fac=function(t){return new(t||D)(d.LFG(u.eN))},D.\u0275prov=d.Yz7({token:D,factory:D.\u0275fac,providedIn:"root"}),a})()},5349:(S,E,o)=>{o.d(E,{M:()=>s});var u=o(5861),g=o(6689),c=o(2014);let s=(()=>{var d;class e{constructor(a){this.storage=a,this._storage=null,this.deviceList=[],this.selectedItemforEdit={deviceID:0,deviceTitle:"new-device",deviceURL:"http://",deviceKEY:"new-key"},this.init()}init(){var a=this;return(0,u.Z)(function*(){const _=yield a.storage.create();a._storage=_,console.log("storage init finished")})()}getLocalAppconfig(){var a=this;return(0,u.Z)(function*(){var _;return yield null===(_=a._storage)||void 0===_?void 0:_.get("LocalAppConfig")})()}saveLocalAppconfig(a){var _=this;return(0,u.Z)(function*(){var t;yield null===(t=_._storage)||void 0===t?void 0:t.set("LocalAppConfig",a)})()}getDeviceList(){var a=this;return(0,u.Z)(function*(){var _;let t=yield null===(_=a._storage)||void 0===_?void 0:_.get("DeviceList");console.log("device list:"+JSON.stringify(t)),t&&(a.deviceList=t)})()}saveDeviceList(a){var _=this;return(0,u.Z)(function*(){var t;yield null===(t=_._storage)||void 0===t?void 0:t.set("DeviceList",a)})()}saveNewDeviceItem(){let a=0;a=this.deviceList.length<1||null==this.deviceList?1:Math.max.apply(Math,this.deviceList.map(_=>_.deviceID))+1,this.selectedItemforEdit.deviceID=a,this.deviceList.push(this.selectedItemforEdit),this.saveDeviceList(this.deviceList)}saveExistingDeviceItem(){this.deviceList[this.selectedItemIndex]=this.selectedItemforEdit,this.saveDeviceList(this.deviceList)}}return(d=e).\u0275fac=function(a){return new(a||d)(g.LFG(c.K))},d.\u0275prov=g.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"}),e})()}}]);