"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2727],{2727:(E,u,i)=>{i.r(u),i.d(u,{HistoricDataPage:()=>A});var r=i(5861),h=i(6814),g=i(95),o=i(3703),l=i(1845),p=i(209),e=i(6689),s=i(6132),n=i(5349);function f(_,D){if(1&_&&(e.TgZ(0,"ion-select-option",16),e._uU(1),e.qZA()),2&_){const v=D.$implicit;e.Q6J("value",v.id),e.xp6(1),e.Oqu(v.name)}}const C=function(){return["/"]};let A=(()=>{var _;class D{constructor(t,a){this.backendDataService=t,this.localAppDataService=a,this.AppConfig={deviceID:0,deviceTitle:"",deviceURL:"",deviceKEY:""},this.chart_time_interval="3hrs",this.selected_sensors="",this.any_LOADING=!1,this.ChartIsLoaded=!1,this.DataUpdateEnabled=!0,this.last_timestamp=""}ngOnInit(){}ionViewWillEnter(){this.localAppDataService.getLocalAppconfig().then(t=>{null!=t&&(this.AppConfig=t,this.backendDataService.ServerURL=this.AppConfig.deviceURL,this.backendDataService.ServerKEY=this.AppConfig.deviceKEY,this.getChartData(),this.refreshIntervalID=setInterval(this.getChartIncrementalData.bind(this),1e3))})}ionViewDidLeave(){this.refreshIntervalID&&clearInterval(this.refreshIntervalID)}getChartData(){var t=this;return(0,r.Z)(function*(){t.any_LOADING=!0,yield t.backendDataService.getChartData(t.chart_time_interval,t.selected_sensors).subscribe(a=>{console.log(a.response_data),t.chart_data=a.response_data,t.show_chart(),t.getSensorList(),t.any_LOADING=!1},a=>{console.log(a),t.any_LOADING=!1})})()}show_chart(){this.HistoricDataChart=l.chart("container",{chart:{type:"spline",events:{load:this.markChartLoaded.bind(this)}},title:{text:"Historic Data"},xAxis:{type:"datetime",dateTimeLabelFormats:{day:"%e %b  %y <br/> %H:%M:%S"}},yAxis:{title:{text:"measurement"}},series:this.chart_data})}markChartLoaded(){this.ChartIsLoaded=!0}getSensorList(){var t=this;return(0,r.Z)(function*(){yield t.backendDataService.getSensorList(t.chart_time_interval).subscribe(a=>{t.SensorList=a.response_data},a=>{console.log(a)})})()}change_period(){this.getChartData()}select_sensors(){var t=this;return(0,r.Z)(function*(){t.getChartData()})()}getChartIncrementalData(){var t=this;return(0,r.Z)(function*(){t.ChartIsLoaded&&t.DataUpdateEnabled&&(yield t.backendDataService.getSensorData().subscribe(a=>{t.last_timestamp!=a.response_data.timestamp&&(t.last_timestamp=a.response_data.timestamp,a.response_data.data.forEach(function(c){let d=c.id,I=c.value,M=Date.parse(a.response_data.timestamp+" UTC");var L=this.HistoricDataChart.get(d),T=parseFloat(I);L&&L.addPoint([M,T],!0,!1)}.bind(t)))},a=>{console.log(a)}))})()}}return(_=D).\u0275fac=function(t){return new(t||_)(e.Y36(s.W),e.Y36(n.M))},_.\u0275cmp=e.Xpm({type:_,selectors:[["app-historic-data"]],standalone:!0,features:[e.jDz],decls:34,vars:9,consts:[[3,"translucent"],["slot","start"],["fill","solid",3,"routerLink"],[1,"ion-padding"],["label","Data period","interface","popover",3,"ngModel","ngModelChange","ionChange"],["value","hour"],["value","3hrs"],["value","6hrs"],["value","day"],["value","3days"],["value","week"],["value","month"],["label","Select Sensors","multiple","true","cancelText","Cancel","okText","OK",3,"ngModel","ionChange","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"enableOnOffLabels","ngModel","checked","ngModelChange"],["id","container",2,"display","block"],[3,"value"]],template:function(t,a){1&t&&(e.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1)(3,"ion-button",2),e._uU(4," < Back"),e.qZA()(),e.TgZ(5,"ion-title"),e._uU(6,"Historic data"),e.qZA()()(),e.TgZ(7,"ion-content",3)(8,"h3"),e._uU(9," Filter "),e.qZA(),e.TgZ(10,"ion-list")(11,"ion-item")(12,"ion-select",4),e.NdJ("ngModelChange",function(d){return a.chart_time_interval=d})("ionChange",function(){return a.change_period()}),e.TgZ(13,"ion-select-option",5),e._uU(14,"hour"),e.qZA(),e.TgZ(15,"ion-select-option",6),e._uU(16,"3 hours"),e.qZA(),e.TgZ(17,"ion-select-option",7),e._uU(18,"6 hours"),e.qZA(),e.TgZ(19,"ion-select-option",8),e._uU(20,"day"),e.qZA(),e.TgZ(21,"ion-select-option",9),e._uU(22,"3 days"),e.qZA(),e.TgZ(23,"ion-select-option",10),e._uU(24,"week"),e.qZA(),e.TgZ(25,"ion-select-option",11),e._uU(26,"month"),e.qZA()()(),e.TgZ(27,"ion-item")(28,"ion-select",12),e.NdJ("ionChange",function(){return a.select_sensors()})("ngModelChange",function(d){return a.selected_sensors=d}),e.YNc(29,f,2,2,"ion-select-option",13),e.qZA()(),e.TgZ(30,"ion-item")(31,"ion-toggle",14),e.NdJ("ngModelChange",function(d){return a.DataUpdateEnabled=d}),e._uU(32,"Realtime data update"),e.qZA()()(),e._UZ(33,"div",15),e.qZA()),2&t&&(e.Q6J("translucent",!0),e.xp6(3),e.Q6J("routerLink",e.DdM(8,C)),e.xp6(9),e.Q6J("ngModel",a.chart_time_interval),e.xp6(16),e.Q6J("ngModel",a.selected_sensors),e.xp6(1),e.Q6J("ngForOf",a.SensorList),e.xp6(2),e.Q6J("enableOnOffLabels",!0)("ngModel",a.DataUpdateEnabled)("checked",a.DataUpdateEnabled))},dependencies:[h.ez,h.sg,g.u5,g.JJ,g.On,p.Bz,p.rH,o.ho,o.Ie,o.t9,o.n0,o.q_,o.W2,o.wd,o.sr,o.Sm,o.Gu]}),D})()},5349:(E,u,i)=>{i.d(u,{M:()=>o});var r=i(5861),h=i(6689),g=i(2014);let o=(()=>{var l;class m{constructor(e){this.storage=e,this._storage=null,this.deviceList=[],this.selectedItemforEdit={deviceID:0,deviceTitle:"new-device",deviceURL:"http://",deviceKEY:"new-key"},this.init()}init(){var e=this;return(0,r.Z)(function*(){const s=yield e.storage.create();e._storage=s,console.log("storage init finished")})()}getLocalAppconfig(){var e=this;return(0,r.Z)(function*(){var s;return yield null===(s=e._storage)||void 0===s?void 0:s.get("LocalAppConfig")})()}saveLocalAppconfig(e){var s=this;return(0,r.Z)(function*(){var n;yield null===(n=s._storage)||void 0===n?void 0:n.set("LocalAppConfig",e)})()}getDeviceList(){var e=this;return(0,r.Z)(function*(){var s;let n=yield null===(s=e._storage)||void 0===s?void 0:s.get("DeviceList");console.log("device list:"+JSON.stringify(n)),n&&(e.deviceList=n)})()}saveDeviceList(e){var s=this;return(0,r.Z)(function*(){var n;yield null===(n=s._storage)||void 0===n?void 0:n.set("DeviceList",e)})()}saveNewDeviceItem(){let e=0;e=this.deviceList.length<1||null==this.deviceList?1:Math.max.apply(Math,this.deviceList.map(s=>s.deviceID))+1,this.selectedItemforEdit.deviceID=e,this.deviceList.push(this.selectedItemforEdit),this.saveDeviceList(this.deviceList)}saveExistingDeviceItem(){this.deviceList[this.selectedItemIndex]=this.selectedItemforEdit,this.saveDeviceList(this.deviceList)}}return(l=m).\u0275fac=function(e){return new(e||l)(h.LFG(g.K))},l.\u0275prov=h.Yz7({token:l,factory:l.\u0275fac,providedIn:"root"}),m})()}}]);